var listUl=document.querySelector("ul"),dir=document.title.match(/^Ls (.+)$/)[1],ls=Array.prototype.slice.call(listUl.children).map(function(a){return a.querySelector("a")}).map(function(a){return{href:a.getAttribute("href"),text:a.textContent}}),viewLs=ls;function updateDir(a){dir=a;document.title="Ls "+dir}function insertionDistance(a,c,b){a=a.toLowerCase();c=c.toLowerCase();a=Array.prototype.slice.call(a);b=b||[];a.reduce(function(a,d){var e=c.indexOf(d,a+1);b.push(e);return e},-1);var d=0;if(-1===b[0]||-1===b[b.length-1])return NaN;b.reduce(function(a,b,c){if(b<=a)return NaN;d+=b-1-a;return b});d+=100*b[0];return d+=(c.length-1-b[b.length-1])/100}function fuzzySearch(a,c){return a.map(function(a){var d=[];return[a,insertionDistance(c,a.text,d),d]}).filter(function(a){return!isNaN(a[1])}).sort(function(a,c){return a[1]-c[1]})}function filter(a){if(""===a)return[ls];a=fuzzySearch(ls,a);return[a.map(function(a){return a[0]}),a.map(function(a){return a[2]})]}function buildUl(a,c){var b=document.createElement("ul");a.forEach(function(a,k){var h=document.createElement("li"),e=document.createElement("a");e.setAttribute("href",a.href);if(c){var f=a.text,g=c[k];g.reduce(function(a,b){a+1<b&&e.appendChild(document.createTextNode(f.substring(a+1,b)));var c=document.createElement("b");c.textContent=f.substr(b,1);e.appendChild(c);return b},-1);e.appendChild(document.createTextNode(f.substr(g[g.length-1]+1)))}else e.textContent=a.text;h.appendChild(e);b.appendChild(h)});return b}function updateLs(a,c){viewLs=a;var b=buildUl(viewLs,c);listUl.parentNode.replaceChild(b,listUl);listUl=b}var queryInp=document.querySelector("input");queryInp.addEventListener("input",function(a){a=filter(queryInp.value);updateLs(a[0],a[1])});function xhr(a){return new Promise(function(c){var b=new XMLHttpRequest;b.open("GET",a);b.send();b.onreadystatechange=function(){return 4===b.readyState&&200===b.status&&c(b.responseText)}})}function goDir(a){xhr("/ls.php?d="+a).then(function(c){updateDir(a);updateLs(ls=JSON.parse(c))})}var searchForm=document.querySelector("form");searchForm.addEventListener("submit",function(a){a.preventDefault();viewLs.length&&(a=viewLs[0].href,"/"===a.substring(a.length-1)?(goDir(a),queryInp.value=""):location.href=a)});
